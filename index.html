<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Dependency Injection & Service Location using StructureMap</title>

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="css/reveal.min.css">
		<link rel="stylesheet" href="css/theme/default.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', use the PDF print sheet -->
		<script>
			document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<div class="slides">
				<section>
					<h1>di-servicelocation-structuremap</h1>
                    <br />
                    <br />
                    <h3>Dependency Injection & Service Location<br />using StructureMap</h3>
                    <br>
                    <p><a href="http://kendaleiv.com">Ken Dale</a> / <a href="http://twitter.com/kendaleiv">@kendaleiv</a></p>
				</section>

                <section>
                    <h1>Inversion of Control</h1>
                    <br />
                    <small>
                        <blockquote cite="http://en.wikipedia.org/wiki/Inversion_of_control">In software engineering, inversion of control (IoC) is a programming technique, expressed here in terms of object-oriented programming, in which object coupling is bound at run time by an assembler object and is typically not known at compile time using static analysis.</blockquote>
                        <a href="http://en.wikipedia.org/wiki/Inversion_of_control">http://en.wikipedia.org/wiki/Inversion_of_control</a>
                    </small>
                    <br />
                    <br />
                    <br />
                    <blockquote cite="http://en.wikipedia.org/wiki/Hollywood_Principle">Don't call us, we'll call you.</blockquote>
                    <small>
                        <a href="http://en.wikipedia.org/wiki/Hollywood_Principle">http://en.wikipedia.org/wiki/Hollywood_Principle</a>
                    </small>
                </section>

                <section>
                    <h1>Dependency Injection</h1>
                    <br />
                    <blockquote cite="http://en.wikipedia.org/wiki/Dependency_injection">Dependency injection is a software design pattern that allows the removal of hard-coded dependencies and makes it possible to change them, whether at run-time or compile-time.</blockquote>
                    <small>
                        <a href="http://en.wikipedia.org/wiki/Dependency_injection">http://en.wikipedia.org/wiki/Dependency_injection</a>
                    </small>
                </section>

                <section>
                    <strong>Constructor injection</strong>
                    <pre><code data-trim contenteditable>
public class MyClass
{
    public MyClass(IService service) { }
}
                    </code></pre>
                    <br />
                    <br />
                    <strong>Property injection</strong>
                    <pre><code data-trim contenteditable>
public class MyClass
{
    public IService MyService { get; set; }
}
                    </code></pre>
                </section>

                <section>
                    <h1>Recommendation</h1>
                    <br />
                    Avoid <strong>property injection</strong> and use <strong>constructor injection</strong>.
                    <br />
                    <br />
                    Constructor injection is more obvious what dependencies an object requires, and ideally the constructors will not allow you to construct the object in a bad state.
                    <br />
                    <br />
                    <br />
                    <small>
                        <a href="http://martinfowler.com/articles/injection.html#ConstructorVersusSetterInjection">http://martinfowler.com/articles/injection.html#ConstructorVersusSetterInjection</a>
                        <br />
                        details when property injection might be appropriate.
                    </small>
                </section>

                <section>
                    <h1>Service Location</h1>
                    <br />
                    <blockquote cite="http://en.wikipedia.org/wiki/Service_locator_pattern">The service locator pattern is a design pattern used in software development to encapsulate the processes involved in obtaining a service with a strong abstraction layer. This pattern uses a central registry known as the "service locator", which on request returns the information necessary to perform a certain task.</blockquote>
                    <small>
                        <a href="http://en.wikipedia.org/wiki/Service_locator_pattern">http://en.wikipedia.org/wiki/Service_locator_pattern</a>
                    </small>
                </section>

                <section>
                    <h1>Recommendation</h1>
                    <br />
                    Put the service locator behind an abstraction layer<br /> to enable provider swapping.
                    <br />
                    <br />
                    <br />
                    <ul>
                        <li>Today: StructureMap &mdash; Tomorrow: ???</li>
                        <li>Testing</li>
                    </ul>
                </section>

                <section>
                    <h1>Inject or locate?</h1>
                    <br />
                    Prefer dependency injection to service location.
                    <br />
                    However, sometimes service location might be a better fit.
                    <br />
                    <br />
                    Use your judgement.
                </section>

                <section>
                    <h1>Why bother?</h1>
                    <br />
                    <ul>
                        <li>Dependencies can have dependencies, which can have dependencies, which ...</li>
                        <li>Dependency injection / service location can simplify testing</li>
                    </ul>
                </section>

                <section>
                    <p><strong><code>&lt;/Basics&gt;</code></strong></p>
                    <img src="https://i.chzbgr.com/maxW500/3539633408/h54166596/" />
                    <p><strong><code>&lt;StructureMap&gt;</code></strong></p>
                </section>

                <section>
                    <h1>StructureMap</h1>
                    <blockquote cite="http://docs.structuremap.net/">StructureMap is a Dependency Injection / Inversion of Control tool for .Net that can be used to improve the architectural qualities of an object oriented system by reducing the mechanical costs of good design techniques.</blockquote>
                    <small>
                        <a href="http://docs.structuremap.net/">http://docs.structuremap.net/</a>
                    </small>
                    <br />
                    <br />
                    <blockquote cite="http://docs.structuremap.net/">StructureMap is the oldest IoC/DI tool for .Net development and has been used in multiple production systems since June 2004.</blockquote>
                    <small>
                        <a href="http://docs.structuremap.net/">http://docs.structuremap.net/</a>
                    </small>
                </section>

                <section>
                    <h1>Setup</h1>
                    <br />
                    <ul>
                        <li>Install NuGet package(s)</li>
                        <li>Configure</li>
                        <li>Win</li>
                    </ul>
                    <br />
                    <br />
                    <br />
                    Supports ASP.NET MVC built in dependency resolver<br />using StructureMap.MVCx NuGet package <em>(where x is version)</em>.
                </section>

                <section>
                    <h1>Simple Usage</h1>
                    <pre><code data-trim contenteditable>
[Fact]
public void ServiceLocation()
{
    var container = new Container(x =>
    {
        x.For&lt;IService&gt;().Use&lt;Service&gt;();
    });

    var service = container.GetInstance&lt;IService&gt;();

    Assert.IsType&lt;Service&gt;(service);
}
                    </code></pre>
                </section>

                <section>
                    <h1>Registries</h1>
                    <pre><code data-trim contenteditable>
public class ServiceRegistry : Registry
{
    public ServiceRegistry()
    {
        For&lt;IService&gt;().Use&lt;Service&gt;();
    }
}

[Fact]
public void Add()
{
    var container = new Container(x =&gt;
    {
        x.AddRegistry&lt;ServiceRegistry&gt;();
    });

    var service = container.GetInstance&lt;IService&gt;();

    Assert.IsType&lt;Service&gt;(service);
}
                    </code></pre>
                </section>

                <section>
                    <h1>Scanning</h1>
                    <pre><code data-trim contenteditable>
[Fact]
public void Scan()
{
    var container = new Container(x =&gt;
    {
        x.Scan(scan =&gt;
        {
            scan.TheCallingAssembly();
            scan.LookForRegistries();
        });
    });

    var service = container.GetInstance&lt;IService&gt;();

    Assert.IsType&lt;Service&gt;(service);
}
                    </code></pre>
                </section>

                <section>
                    <h1>Dependency Injection</h1>
                    <br />
                    ASP.NET MVC and WebApi<br />have dependency resolution built in.
                    <br />
                    <br />
                    You can instruct them to use StructureMap.
                </section>

                <section>
                    <h2>WebApi Controller Example</h2>
                    <pre><code data-trim contenteditable>
public class ServiceIdController : ApiController
{
    private readonly IService _service;

    public ServiceIdController(IService service)
    {
        _service = service;
    }

    public string Get()
    {
        return "ServiceId: " + _service.Id;
    }
}
                    </code></pre>
                </section>

                <section>
                    <h2>StructureMap Lifetimes</h2>
                    <br />
                    <pre><code data-trim contenteditable>
x.For&lt;IService&gt;().LifecycleIs&lt;HybridLifecycle&gt;().Use&lt;Service&gt;();
                    </code></pre>
                    <br />
                    <pre><code data-trim contenteditable>
x.For&lt;IService&gt;().LifecycleIs&lt;HybridSessionLifecycle&gt;().Use&lt;Service&gt;();
                    </code></pre>
                    <br />
                    <pre><code data-trim contenteditable>
x.For&lt;IService&gt;().Singleton().Use&lt;Service&gt;();
                    </code></pre>
                    <br />
                    <pre><code data-trim contenteditable>
x.For&lt;IService&gt;().Transient().Use&lt;Service&gt;();
                    </code></pre>
                </section>

                <section>
                    <h1>Troubleshooting</h1>
                    <img src="https://i.chzbgr.com/maxW500/4226478080/hDEAEFE01/" />
                </section>

                <section>
                    <pre><code data-trim contenteditable>
[Fact]
public void ShowBuildPlan()
{
    var container = new Container(x =&gt;
    {
        x.For&lt;IService&gt;().Use&lt;Service&gt;();
    });

    var buildPlan = container.Model.For&lt;IService&gt;()
        .Default
        .DescribeBuildPlan();

    var expectedBuildPlan =
@"PluginType: Core.IService
Lifecycle: Transient
new Service()
";

    Assert.Equal(expectedBuildPlan, buildPlan);
}
                    </code></pre>
                </section>

                <section>
                    <pre><code data-trim contenteditable>
[Fact]
public void WhatDoIHave()
{
    var container = new Container(x =&gt;
    {
        x.For&lt;IService&gt;().Use&lt;Service&gt;();
    });

    var whatDoIHave = container.WhatDoIHave();

    var expectedWhatDoIHave = @"

===================================================================================================
PluginType           Namespace        Lifecycle     Description                           Name
---------------------------------------------------------------------------------------------------
Func&lt;TResult&gt;        System           Transient     Open Generic Template for Func&lt;&gt;      (Default)
---------------------------------------------------------------------------------------------------
Func&lt;T, TResult&gt;     System           Transient     Open Generic Template for Func&lt;,&gt;     (Default)
---------------------------------------------------------------------------------------------------
IContainer           StructureMap     Singleton     Object:  StructureMap.Container       (Default)
---------------------------------------------------------------------------------------------------
IService             Core             Transient     Core.Service                          (Default)
---------------------------------------------------------------------------------------------------
Lazy&lt;T&gt;              System           Transient     Open Generic Template for Func&lt;&gt;      (Default)
===================================================================================================";

    Assert.Equal(expectedWhatDoIHave, whatDoIHave);
}
                    </code></pre>
                </section>

                <section>
                    <h2>Questions?</h2>
                    <p><a href="http://kendaleiv.com">Ken Dale</a> / <a href="http://twitter.com/kendaleiv">@kendaleiv</a></p>
                </section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

				// Parallax scrolling
				// parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
				// parallaxBackgroundSize: '2100px 900px',

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>
